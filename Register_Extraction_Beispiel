from bs4 import BeautifulSoup
import pandas as pd
import re

# XHTML-Datei einlesen
with open("register.xhtml", "r", encoding="utf-8") as f:
    html_content = f.read()

# HTML parsen
soup = BeautifulSoup(html_content, "lxml")

entries = soup.find_all("div", class_="entry")
data = []

for entry in entries:
    birthdeath = entry.find("div", class_="birthdeath")
    if birthdeath:
        birth_text = birthdeath.get_text()
        birth_match = re.search(r"\* (\d{3,4})", birth_text)
        if birth_match and int(birth_match.group(1)) > 1500:
            birthyear = int(birth_match.group(1))
        else:
            continue

        name = entry.find("h1", class_="prefname").get_text(strip=True) if entry.find("h1", class_="prefname") else ""
        faith_tag = entry.find("div", class_="faith")
        faith = faith_tag.get_text(strip=True) if faith_tag else ""

        occurrences = entry.find("div", class_="occurrencescontainer")
        if occurrences and "Regensburg 1613, fol. 57v105v:" in occurrences.get_text():
            occurrence_snippets = occurrences.find_all("li")
            matching_snippets = [li.get_text(strip=True) for li in occurrence_snippets if "Regensburg 1613, fol. 57v105v:" in li.get_text()]
            
            for snippet in matching_snippets:
                data.append({
                    "Name": name,
                    "Geburtsjahr": birthyear,
                    "Konfession": faith,
                    "Textstelle": snippet
                })

df = pd.DataFrame(data)
df.to_csv("Personen_Regensburg1613.csv", index=False, encoding='utf-8', sep=';')
